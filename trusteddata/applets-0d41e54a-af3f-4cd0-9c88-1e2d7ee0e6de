{"id":"0d41e54a-af3f-4cd0-9c88-1e2d7ee0e6de","content":"{\"html\":\"\",\"js\":\"let U \u003d getUApi();\\nlet pageNo \u003d 0;\\n\\nlet loadNotifs \u003d () \u003d\u003e {\\n    let url \u003d `/notifications?offset\u003d${pageNo}\u0026size\u003d10`\\n    console.log(url)\\n    get(url)\\n        .then(resp \u003d\u003e JSON.parse(resp.response))\\n        .then(notifications \u003d\u003e { if (notifications.length \u003c 10) loadMore.remove(); return notifications })\\n        .then(notifications \u003d\u003e notifications.map(n \u003d\u003e {\\n            let ndiv \u003d U.makeDiv({ style: `position: relative; padding: 20px; border-radius: 5px; border: solid 1px darkgreen; background-color: ${n.seen ? \u0027white\u0027 : \u0027#E4FFC8\u0027}; margin: 5px` }, container)\\n            U.makeSpan({ innerHTML: `\u003ci\u003e${n.nfrom} on ${new Date(n.ptime).toLocaleString()}\u003c/i\u003e`, style: \u0027display: block; color: gray; margin-bottom: 10px; font-size: 0.9em\u0027 }, ndiv)\\n            U.makeSpan({ innerHTML: n.ntext }, ndiv)\\n            let ctrls \u003d U.makeDiv({style: \u0027position:absolute; bottom: 5px; right: 5px; font-size: 0.9em\u0027}, ndiv)\\n            if (!n.seen) {\\n                U.makeA({ innerHTML: \u0027mark as read\u0027, title: \u0027mark as read\u0027, href: \u0027#\u0027, style: \u0027margin: 3px\u0027}, ctrls)\\n                    .addEventListener(\u0027click\u0027, function () {\\n                        post(`/notifications/markasseen?for\u003d${n.nfor}\u0026from\u003d${n.nfrom}\u0026ptime\u003d${n.ptime}`)\\n                            .then(x \u003d\u003e inodes.updateNotificationsCount())\\n                            .then(x \u003d\u003e ndiv.style.backgroundColor \u003d \u0027white\u0027)\\n                            .then(x \u003d\u003e this.remove())\\n                    })\\n            }\\n            U.makeA({ innerHTML: \u0027delete\u0027, title: \u0027mark as read\u0027, href: \u0027#\u0027, style: \u0027margin: 3px\u0027 }, ctrls)\\n                    .addEventListener(\u0027click\u0027, function () {\\n                        delet(`/notifications/delete?for\u003d${n.nfor}\u0026from\u003d${n.nfrom}\u0026ptime\u003d${n.ptime}`)\\n                            .then(x \u003d\u003e inodes.updateNotificationsCount())\\n                            .then(x \u003d\u003e ndiv.remove())\\n                    })\\n        }))\\n        .then(() \u003d\u003e pageNo +\u003d 1)\\n        .catch(e \u003d\u003e { console.log(e); showError(e) })\\n}\\n\\nU.makeH2({ innerHTML: \\\"Notifications\\\" })\\nlet container \u003d U.makeDiv();\\nlet loadMore \u003d U.makeA({ href: \u0027#\u0027, innerHTML: \u0027Load older\u0027, style: \u0027display: block; text-align: center\u0027 })\\nloadMore.addEventListener(\u0027click\u0027, loadNotifs)\\nloadMore.click();\"}","type":"applets","tags":["inodesapp","notifications"],"owner":"admin","postTime":1620657960144,"visibility":["g-public"],"savedVisibility":["g-public"],"needsApproval":false}